<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2 Design &mdash; pyPAHdb  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=4f65f77d" />

  
    <link rel="shortcut icon" href="_static/touch-icon-310x310.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3 Installation" href="installation.html" />
    <link rel="prev" title="1 Background" href="background.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pyPAHdb
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="background.html"><span class="sectnum">1 </span>Background</a><ul>
<li class="toctree-l2"><a class="reference internal" href="background.html#purpose"><span class="sectnum">1.1 </span>Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#features"><span class="sectnum">1.2 </span>Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#academic-references"><span class="sectnum">1.3 </span>Academic references</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><span class="sectnum">2 </span>Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#flowchart"><span class="sectnum">2.1 </span>Flowchart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-data-formats"><span class="sectnum">2.2 </span>Supported data formats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html"><span class="sectnum">3 </span>Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html"><span class="sectnum">4 </span>Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#details"><span class="sectnum">4.1 </span>Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pypahdb.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb.decomposer_base">pypahdb.decomposer_base module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pypahdb.html#pypahdb.decomposer_base.DecomposerBase"><code class="docutils literal notranslate"><span class="pre">DecomposerBase</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb.decomposer">pypahdb.decomposer module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pypahdb.html#pypahdb.decomposer.Decomposer"><code class="docutils literal notranslate"><span class="pre">Decomposer</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb.observation">pypahdb.observation module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pypahdb.html#pypahdb.observation.Observation"><code class="docutils literal notranslate"><span class="pre">Observation</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb.picker">pypahdb.picker module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pypahdb.html#pypahdb.picker.Picker"><code class="docutils literal notranslate"><span class="pre">Picker</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release-history.html#v1-0-2024-05-06">v1.0 (2024-05-06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="release-history.html#v0-6-1-2018-10-12">v0.6.1 (2018-10-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="release-history.html#v0-6-0-2018-08-15">v0.6.0 (2018-08-15)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyPAHdb</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="sectnum">2 </span>Design</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="background.html" class="btn btn-neutral float-left" title="1 Background" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="installation.html" class="btn btn-neutral float-right" title="3 Installation" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><strong>Please note that what is described here is based on</strong> <a class="reference external" href="https://doi.org/10.25080/majora-4af1f417-00f">Shannon &amp; Boersma
(2018)</a> <strong>and some
implementation details will have changed since then.</strong></p>
<section id="design">
<h1><span class="sectnum">2 </span>Design<a class="headerlink" href="#design" title="Link to this heading"></a></h1>
<p>PyPAHdb analyzes spectroscopic observations (including spectral maps)
and characterizes the PAH emission in terms of PAH ionization and size
fractions using a database-fitting approach.</p>
<p>The pyPAHdb package is imported with the following statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pypahdb</span>
</pre></div>
</div>
<section id="flowchart">
<h2><span class="sectnum">2.1 </span>Flowchart<a class="headerlink" href="#flowchart" title="Link to this heading"></a></h2>
<figure class="align-center" id="id5">
<img alt="_images/fig_flowchart.png" src="_images/fig_flowchart.png" />
<figcaption>
<p><span class="caption-text">PyPAHdb flowchart. (1) Astronomical spectroscopic data is loaded from
FITS or ASCII files. (2) A highly over-sampled pre-computed matrix of
PAH spectra is loaded and interpolated onto the wavelength grid of the
astronomical observations. Database-fitting is performed using a
non-negative least-squares (NNLS) approach, which yields the contribution
of an individual PAH molecule. As a result, the fit can be broken down in
terms of PAH charge and size. (3) The results are written to disk as a
single FITS file and as a PDF summarizing the results (one page per pixel,
if a spectral cube is provided as input).</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The general program methodology is encapsulated in the flowchart
presented in the figure above and is as follows:</p>
<ol class="arabic simple">
<li><p>Read-in a file containing spectroscopic PAH observations of an
astronomical object. This functionality is provided by the class
<code class="docutils literal notranslate"><span class="pre">Observation</span></code>, which is implemented in <code class="docutils literal notranslate"><span class="pre">observation.py</span></code>. It is
the responsibility of the user to ensure all non-PAH emission
components have been removed from the spectrum. The class uses a
fall-through try-except chain to attempt to read the given
filename using the facilities provided by <code class="docutils literal notranslate"><span class="pre">astropy.io</span></code>. The
spectroscopic data is stored as a <code class="docutils literal notranslate"><span class="pre">specutils.Spectrum1D</span></code>
object. The <code class="docutils literal notranslate"><span class="pre">Spectrum1D</span></code> class provides functionality to convert
between different coordinate representations. Below is example
Python code demonstrating the use of the class. The file
<code class="docutils literal notranslate"><span class="pre">sample_data_NGC7023.tbl</span></code> in this demonstration is bundled with the
pyPAHdb package. The output of the demonstration code is shown in the
flowchart.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pkg_resources</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pypahdb.observation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observation</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;resources/sample_data_NGC7023.tbl&#39;</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;pypahdb&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Observation</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Decompose the observed PAH emission in terms of contributing PAH
subclasses, here charge and size. This functionality
is provided by the class <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code>, which is implemented in
<code class="docutils literal notranslate"><span class="pre">decomposer.py</span></code> and takes <code class="docutils literal notranslate"><span class="pre">decomposer_base.py</span></code> as its base.
The <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code> class takes as input a <code class="docutils literal notranslate"><span class="pre">Spectrum1D</span></code> object,
of which it takes a deep copy and calls the
<code class="docutils literal notranslate"><span class="pre">Unit.to</span></code> method on to convert the abscissa units
to wavenumber. Subsequently, a pre-computed <code class="docutils literal notranslate"><span class="pre">numpy</span></code> matrix of
highly oversampled PAH emission spectra stored as a <code class="docutils literal notranslate"><span class="pre">pickle</span></code> is
loaded from file. Utilizing <code class="docutils literal notranslate"><span class="pre">numpy.interp</span></code>, each of the PAH
emission spectra, represented by a single column in the
pre-computed matrix, is interpolated onto the frequency grid (in
wavenumber) of the input spectrum. This process is parallelized
using the <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> package. <code class="docutils literal notranslate"><span class="pre">optimize.nnls</span></code> is used
to perform a non-negative least-squares (NNLS) fit of the
interpolated, pre-computed spectra to the input spectra. NNLS is
chosen because it is appropriate to the problem, fast, and always
converges. The solution vector (weights) is stored as an attribute
and considered private to <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code>. Combining lazy instantiation
and Python’s &#64;property, the fit and the breakdown can be retrieved. When
the input spectrum represents a spectral cube the calculations are
parallelized across each pixel using, again, the
<code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> package. Below is example code demonstrating
the use of the <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code> and extends the previous code-block. The
output from the code-block is shown in the flowchart.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pypahdb.decomposer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decomposer</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">Decomposer</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">spectrum</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">fit</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Save the results to file. The output summarizes the results from the
<code class="docutils literal notranslate"><span class="pre">Decomposer</span></code> class to allow users assessing the quality of the fit
and store the derived PAH properties for later retrieval. The
<code class="docutils literal notranslate"><span class="pre">Decomposer</span></code> class uses <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code> to write FITS-files. The
class will attempt to incorporate relevant information when a (FITS)
header is provided. Below is example code demonstrating the use of the
class, which extends the previous code-block. The output from the
code-block is shown in the flowchart.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">save_pdf</span><span class="p">(</span><span class="s1">&#39;NGC7023_pypahdb.pdf&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">save_fits</span><span class="p">(</span><span class="s1">&#39;NGC7023_pypahdb.fits&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="supported-data-formats">
<h2><span class="sectnum">2.2 </span>Supported data formats<a class="headerlink" href="#supported-data-formats" title="Link to this heading"></a></h2>
<p>PyPAHdb supports reading in IPAC tables, <em>Spitzer</em> FITS files, and <em>JWST</em> FITS
files. Support for reading pahfit<a class="footnote-reference brackets" href="#id3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>-files is underway. Pahfit is being
developed as part of the same <em>JWST</em> ERS Program<a class="footnote-reference brackets" href="#id4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> as pyPAHdb.</p>
<hr class="docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://github.com/pahfit/pahfit">github.com/pahfit/pahfit</a></p>
</aside>
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://pdrs4all.org/">website</a></p>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="background.html" class="btn btn-neutral float-left" title="1 Background" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="installation.html" class="btn btn-neutral float-right" title="3 Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2025 ⸺ Dr. C. Boersma,  Dr. M.J. Shannon, and Dr. A. Maragkoudakis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>