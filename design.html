

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2 Design &mdash; pyPAHdb  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/touch-icon-310x310.png"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3 Installation" href="installation.html" />
    <link rel="prev" title="1 Background" href="background.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pyPAHdb
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="background.html"><span class="sectnum">1</span> Background</a><ul>
<li class="toctree-l2"><a class="reference internal" href="background.html#purpose"><span class="sectnum">1.1</span> Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#features"><span class="sectnum">1.2</span> Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#academic-references"><span class="sectnum">1.3</span> Academic references</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><span class="sectnum">2</span> Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#flowchart"><span class="sectnum">2.1</span> Flowchart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-data-formats"><span class="sectnum">2.2</span> Supported data formats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html"><span class="sectnum">3</span> Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html"><span class="sectnum">4</span> Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#details"><span class="sectnum">4.1</span> Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pypahdb.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb.decomposer_base">pypahdb.decomposer_base module</a></li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb.decomposer">pypahdb.decomposer module</a></li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb.observation">pypahdb.observation module</a></li>
<li class="toctree-l2"><a class="reference internal" href="pypahdb.html#module-pypahdb">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release-history.html#v0-6-1-2018-10-12">v0.6.1 (2018-10-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="release-history.html#v0-6-0-2018-08-15">v0.6.0 (2018-08-15)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyPAHdb</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="sectnum">2</span> Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="installation.html" class="btn btn-neutral float-right" title="3 Installation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="background.html" class="btn btn-neutral float-left" title="1 Background" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="design">
<h1><span class="sectnum">2</span> Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h1>
<p>pypahdb analyzes spectroscopic observations (including spectral maps)
and characterizes the PAH emission using a database-fitting approach,
providing the PAH ionization and size fractions.</p>
<p>The package is imported with the following statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypahdb</span>
</pre></div>
</div>
<div class="section" id="flowchart">
<h2><span class="sectnum">2.1</span> Flowchart<a class="headerlink" href="#flowchart" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center" id="id1">
<img alt="_images/fig_flowchart.png" src="_images/fig_flowchart.png" />
<p class="caption"><span class="caption-text">pypahdb flowchart. (1) Astronomical spectroscopic data is loaded,
whether loaded rom FITS or ASCII files. (2) An over-sampled
pre-computed matrix of PAH spectra is loaded and interpolated onto
the wavelength grid of the astronomical
observations. Database-fitting is performed using non-negative
least-squares (NNLS), which yields the contribution of an
individual PAH molecule to the total fit. As a result, we obtain a
breakdown of the model fit in terms of PAH charge and size. (3) The
results are written to disk as a single FITS file and as a PDF
summarizing the results (one page per pixel, if a spectral cube is
provided as input).</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The general program methodology is encapsulated in the flowchart
presented in the figure above and is as follows:</p>
<ol class="arabic simple">
<li><p>Read-in a file containing spectroscopic PAH observations of an
astronomical object. This functionality is provided by the class
<code class="docutils literal notranslate"><span class="pre">Observation</span></code>, which is implemented in <code class="docutils literal notranslate"><span class="pre">observation.py</span></code>. It is
the responsibility of the user to ensure all non-PAH emission
components have been removed from the spectrum. The class uses a
fall-through try-except chain to attempt to read the given
filename using the facilities provided by <code class="docutils literal notranslate"><span class="pre">astropy.io</span></code>. The
spectroscopic data is stored as a <code class="docutils literal notranslate"><span class="pre">specutils.Spectrum1D</span></code>
object. The <code class="docutils literal notranslate"><span class="pre">Spectrum1D</span></code> class provides functionality to convert
between different coordinate representations. Below is example
Python code demonstrating the use of the class. The file
<code class="docutils literal notranslate"><span class="pre">sample_data_NGC7023.tbl</span></code> in this demonstration can be
found in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> directory that is part of the pyPAHdb
package. The output of the following code-block is shown in the
flowchart.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pypahdb.observation</span> <span class="kn">import</span> <span class="n">Observation</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;sample_data_NGC7023.tbl&#39;</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Observation</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Decompose the observed PAH emission into contributions from
different PAH subclasses, here charge and size. This functionality
is provided by the class <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code>, which is implemented in
<code class="docutils literal notranslate"><span class="pre">decomposer.py</span></code>. The class takes as input a <code class="docutils literal notranslate"><span class="pre">Spectrum1D</span></code> object,
of which it creates a deep copy and calls the
<code class="docutils literal notranslate"><span class="pre">Unit.to`</span> <span class="pre">method</span> <span class="pre">to</span> <span class="pre">convert</span> <span class="pre">the</span> <span class="pre">abscissa</span> <span class="pre">units</span>
<span class="pre">to</span> <span class="pre">wavenumber.</span> <span class="pre">Subsequently,</span> <span class="pre">a</span> <span class="pre">pre-computed</span> <span class="pre">``numpy</span></code> matrix of
highly oversampled PAH emission spectra stored as a <code class="docutils literal notranslate"><span class="pre">pickle</span></code> is
loaded from file. Utilizing <code class="docutils literal notranslate"><span class="pre">numpy.interp</span></code>, each of the PAH
emission spectra, represented by a single column in the
pre-computed matrix, is interpolated onto the frequency grid (in
wavenumber) of the input spectrum. This process is parallelized
using the <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> package. <code class="docutils literal notranslate"><span class="pre">optimize.nnls</span></code> is used
to perform a non-negative least-squares (NNLS) fit of the
pre-computed spectra to the input spectra. NNLS is chosen because
it is appropriate to the problem, fast, and always converges. The
solution vector (weights) is stored as an attribute and considered
private. Combining lazy instantiation and Python’s &#64;property, the
results of the fit and the breakdown can be retrieved. In case the
input spectrum represents a spectral cube and where possible, the
calculations are parallelized across each pixel using, again, the
<code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> package. Below is example code demonstrating
the use of the class and extends the previous code-block. The
output of the code-block is shown in the flowchart.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pypahdb.decomposer</span> <span class="kn">import</span> <span class="n">Decomposer</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">Decomposer</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">spectrum</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">fit</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Produce output to file given a <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code> object. Previously
stored within the <code class="docutils literal notranslate"><span class="pre">Writer</span></code> class, this functionality is now
contained within <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code> itself. The output serves to
summarize the results from the <code class="docutils literal notranslate"><span class="pre">Decomposer</span></code> class so that a user
may assess the quality of the fit and store the PAH
characteristics of their astronomical observations. The class uses
<code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code> to write the PAH characteristics to a FITS file
and the <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> package to generate a PDF summarizing the
results. The class will attempt to incorporate relevant
information from any (FITS) header provided. Below is example code
demonstrating the use of the class, which extends the previous
code-block. The size breakdown part of the generated PDF output is
shown in the flowchart.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">save_pdf</span><span class="p">(</span><span class="s1">&#39;NGC7023_pypahdb.pdf&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">save_fits</span><span class="p">(</span><span class="s1">&#39;NGC7023_pypahdb.fits&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="supported-data-formats">
<h2><span class="sectnum">2.2</span> Supported data formats<a class="headerlink" href="#supported-data-formats" title="Permalink to this headline">¶</a></h2>
<p>Presently, pypahdb supports IPAC tables and Spitzer FITS files.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="installation.html" class="btn btn-neutral float-right" title="3 Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="background.html" class="btn btn-neutral float-left" title="1 Background" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Dr. Christiaan Boersma and Dr. Matthew J. Shannon

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>